
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>C++中与时间相关的库 | 思</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在使用C++开发时，会遇到多个时间库，C风格时间函数，std::chrono库，Boost.Date_Time库。他们都包含哪些时间函数或者类？它们的设计思想是什么？什么情况选择什么样的时间库呢？怎么使用呢？在使用时大家可能都会有这些疑问，下面就对这些库总结一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="C++中与时间相关的库">
<meta property="og:url" content="http://yoursite.com/2016/01/04/C++中与时间相关的库/index.html">
<meta property="og:site_name" content="思">
<meta property="og:description" content="在使用C++开发时，会遇到多个时间库，C风格时间函数，std::chrono库，Boost.Date_Time库。他们都包含哪些时间函数或者类？它们的设计思想是什么？什么情况选择什么样的时间库呢？怎么使用呢？在使用时大家可能都会有这些疑问，下面就对这些库总结一下。">
<meta property="og:image" content="http://yoursite.com/./images/time%20zone.png">
<meta property="og:image" content="http://yoursite.com/./images/chrono.png">
<meta property="og:image" content="http://yoursite.com/./images/time_duration_inherit.png">
<meta property="og:updated_time" content="2016-01-04T08:29:43.516Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C++中与时间相关的库">
<meta name="twitter:description" content="在使用C++开发时，会遇到多个时间库，C风格时间函数，std::chrono库，Boost.Date_Time库。他们都包含哪些时间函数或者类？它们的设计思想是什么？什么情况选择什么样的时间库呢？怎么使用呢？在使用时大家可能都会有这些疑问，下面就对这些库总结一下。">
  
    <link rel="alternative" href="/atom.xml" title="思" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">思</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">我的技术总结</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="yoursite.com">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-C++中与时间相关的库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/04/C++中与时间相关的库/" class="article-date">
  <time datetime="2016-01-04T08:29:43.516Z" itemprop="datePublished">2016-01-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/技术/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      C++中与时间相关的库
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <!-- Table of Contents -->
      
      <div id="toc" class="toc-article">
      <strong class="toc-title">文章目录</strong>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#C_u98CE_u683C_u7684_u65F6_u95F4_u51FD_u6570"><span class="toc-number">1.</span> <span class="toc-text">C风格的时间函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#time_t"><span class="toc-number">1.1.</span> <span class="toc-text">time_t</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time"><span class="toc-number">1.2.</span> <span class="toc-text">time</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gmtime"><span class="toc-number">1.3.</span> <span class="toc-text">gmtime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#localtime"><span class="toc-number">1.4.</span> <span class="toc-text">localtime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mktime"><span class="toc-number">1.5.</span> <span class="toc-text">mktime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ctime"><span class="toc-number">1.6.</span> <span class="toc-text">ctime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#asctime"><span class="toc-number">1.7.</span> <span class="toc-text">asctime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#difftime"><span class="toc-number">1.8.</span> <span class="toc-text">difftime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strftime"><span class="toc-number">1.9.</span> <span class="toc-text">strftime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#clock"><span class="toc-number">1.10.</span> <span class="toc-text">clock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7EBF_u7A0B_u5B89_u5168"><span class="toc-number">1.11.</span> <span class="toc-text">线程安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C_u98CE_u683C_u65F6_u95F4_u51FD_u6570_u4E0E_u65F6_u533A_u5173_u7CFB"><span class="toc-number">1.12.</span> <span class="toc-text">C风格时间函数与时区关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#std_3A_3Achrono_u65F6_u95F4_u5E93"><span class="toc-number">2.</span> <span class="toc-text">std::chrono时间库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#duration"><span class="toc-number">2.1.</span> <span class="toc-text">duration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#system_clock"><span class="toc-number">2.2.</span> <span class="toc-text">system_clock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#steady_clock"><span class="toc-number">2.3.</span> <span class="toc-text">steady_clock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#high_resolution_clock"><span class="toc-number">2.4.</span> <span class="toc-text">high_resolution_clock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time_point"><span class="toc-number">2.5.</span> <span class="toc-text">time_point</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5176_u5B83_u8F85_u52A9_u51FD_u6570"><span class="toc-number">2.6.</span> <span class="toc-text">其它辅助函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#time_point_cast"><span class="toc-number">2.6.1.</span> <span class="toc-text">time_point_cast</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#duration_cast"><span class="toc-number">2.6.2.</span> <span class="toc-text">duration_cast</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u603B_u7ED3"><span class="toc-number">2.7.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u683C_u5F0F_u5316_u65F6_u95F4"><span class="toc-number">2.8.</span> <span class="toc-text">格式化时间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#time_point_u683C_u5F0F_u5316"><span class="toc-number">2.8.1.</span> <span class="toc-text">time_point格式化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#boost_u65F6_u95F4_u5E93"><span class="toc-number">3.</span> <span class="toc-text">boost时间库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chrono"><span class="toc-number">3.1.</span> <span class="toc-text">Chrono</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Date_Time"><span class="toc-number">3.2.</span> <span class="toc-text">Date_Time</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Gregorian"><span class="toc-number">3.2.1.</span> <span class="toc-text">Gregorian</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Date"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">Date</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Date_Duration"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">Date Duration</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Date_Period"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">Date Period</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Posix_Time"><span class="toc-number">3.2.2.</span> <span class="toc-text">Posix Time</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Ptime"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">Ptime</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Time_Duration"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">Time Duration</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Time_Period"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">Time Period</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Local_Time"><span class="toc-number">3.2.3.</span> <span class="toc-text">Local Time</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Time_Zone_uFF08_u62BD_u8C61_uFF09"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">Time Zone（抽象）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Posix_Time_Zone"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">Posix Time Zone</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Time_Zone_Database"><span class="toc-number">3.2.3.3.</span> <span class="toc-text">Time Zone Database</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Local_Date_Time"><span class="toc-number">3.2.3.4.</span> <span class="toc-text">Local Date Time</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Local_Time_Period"><span class="toc-number">3.2.3.5.</span> <span class="toc-text">Local Time Period</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Date_Time_Input/Output"><span class="toc-number">3.2.4.</span> <span class="toc-text">Date Time Input/Output</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IO_u5BF9_u8C61"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">IO对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Formatter/Parser_u5BF9_u8C61"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">Formatter/Parser对象</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#std_3A_3Achrono_u4E0EBoost-Date_Time_u5173_u7CFB"><span class="toc-number">4.</span> <span class="toc-text">std::chrono与Boost.Date_Time关系</span></a></li></ol>
      </div>
      
      <p>在使用C++开发时，会遇到多个时间库，C风格时间函数，std::chrono库，Boost.Date_Time库。<br>他们都包含哪些时间函数或者类？它们的设计思想是什么？什么情况选择什么样的时间库呢？怎么使用呢？在使用时大家可能都会有这些疑问，下面就对这些库总结一下。</p>
<a id="more"></a>
<h2 id="C_u98CE_u683C_u7684_u65F6_u95F4_u51FD_u6570"><a href="#C_u98CE_u683C_u7684_u65F6_u95F4_u51FD_u6570" class="headerlink" title="C风格的时间函数"></a>C风格的时间函数</h2><p>下面的函数，有<code>C</code>和<code>C++</code>两个版本，如果使用C版本需要包含<code>(time.h)</code>，如果使用C++版本需要包含<code>&lt;ctime&gt;</code>，命名空间是std。</p>
<h3 id="time_t"><a href="#time_t" class="headerlink" title="time_t"></a>time_t</h3><p>对于c++编程，肯定会用到time_t，它被用于表示Unix时间（戳）。<br>linux下存储时间常见的有两种存储方式，一个是从1970年到现在经过了多少秒，一个是用一个结构来分别存储年月日时分秒的。<br>time_t 这种类型就是用来存储从1970年01月01日00时00分00秒 UTC到现在经过了多少秒，要想更精确一点，可以用结构struct timeval，它精确到微妙。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> timeval</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">long</span> tv_sec; <span class="comment">/*秒*/</span></span><br><span class="line">    <span class="keyword">long</span> tv_usec; <span class="comment">/*微秒*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>而直接存储年月日的是一个结构：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> tm</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> tm_sec;  <span class="comment">/*秒，正常范围0-59， 但允许至61, C99(C++11)改为60*/</span></span><br><span class="line">    <span class="keyword">int</span> tm_min;  <span class="comment">/*分钟，0-59*/</span></span><br><span class="line">    <span class="keyword">int</span> tm_hour; <span class="comment">/*小时， 0-23*/</span></span><br><span class="line">    <span class="keyword">int</span> tm_mday; <span class="comment">/*日，即一个月中的第几天，1-31*/</span></span><br><span class="line">    <span class="keyword">int</span> tm_mon;  <span class="comment">/*月， 从一月算起，0-11*/</span>  <span class="number">1</span>+tm_mon;</span><br><span class="line">    <span class="keyword">int</span> tm_year;  <span class="comment">/*年， 从1900至今已经多少年*/</span>  <span class="number">1900</span>+tm_year;</span><br><span class="line">    <span class="keyword">int</span> tm_wday; <span class="comment">/*星期，一周中的第几天， 从星期日算起，0-6*/</span></span><br><span class="line">    <span class="keyword">int</span> tm_yday; <span class="comment">/*从今年1月1日到目前的天数，范围0-365，其中0代表1月1日，1代表1月2日，以此类推*/</span></span><br><span class="line">    <span class="keyword">int</span> tm_isdst; <span class="comment">/* 夏令时标识符，实行夏令时的时候，tm_isdst为正。不实行夏令时的进候，tm_isdst为0；不了解情况时，tm_isdst()为负。*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>需要特别注意的是，年份是从1900年起至今多少年，而不是直接存储如2011年，月份从0开始的，0表示一月，星期也是从0开始的， 0表示星期日，1表示星期一。</p>
<p>参考<a href="http://blog.csdn.net/love_gaohz/article/details/6637625" target="_blank" rel="external">c++ 时间类型详解 time_t</a></p>
<h3 id="time"><a href="#time" class="headerlink" title="time"></a>time</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span> time (<span class="keyword">time_t</span>* timer);</span><br></pre></td></tr></table></figure>
<p>返回自从00:00 hours, Jan 1, 1970 UTC (i.e., the current unix timestamp)到现在的秒数。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span> timer;</span><br><span class="line">time(&amp;timer);  <span class="comment">/* get current time; same as: timer = time(NULL)  */</span></span><br></pre></td></tr></table></figure></p>
<h3 id="gmtime"><a href="#gmtime" class="headerlink" title="gmtime"></a>gmtime</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">struct</span> tm * <span class="title">gmtime</span> <span class="params">(<span class="keyword">const</span> time_t * timer)</span></span>;</span><br></pre></td></tr></table></figure>
<p>转换time_t成UTC时间的tm结构体。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span> rawtime;</span><br><span class="line"><span class="keyword">struct</span> tm * ptm;</span><br><span class="line">time ( &amp;rawtime );</span><br><span class="line">ptm = gmtime ( &amp;rawtime );</span><br></pre></td></tr></table></figure></p>
<h3 id="localtime"><a href="#localtime" class="headerlink" title="localtime"></a>localtime</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">struct</span> tm * <span class="title">localtime</span> <span class="params">(<span class="keyword">const</span> time_t * timer)</span></span>;</span><br></pre></td></tr></table></figure>
<p>转换time_t成本地时间的tm结构体。<br>多个线程同时调用<strong>localtime</strong>会引起数据竞争。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span> rawtime;</span><br><span class="line"><span class="keyword">struct</span> tm * timeinfo;</span><br><span class="line"></span><br><span class="line">time (&amp;rawtime);</span><br><span class="line">timeinfo = localtime (&amp;rawtime);</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">"Current local time and date: %s"</span>, asctime(timeinfo));</span><br></pre></td></tr></table></figure></p>
<h3 id="mktime"><a href="#mktime" class="headerlink" title="mktime"></a>mktime</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">time_t</span> mktime (<span class="keyword">struct</span> tm * timeptr);</span><br></pre></td></tr></table></figure>
<p>转换本地时间的tm结构体成time_t。<br>这个函数是<strong>localtime</strong>的反变换。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">time_t</span> t = <span class="built_in">std</span>::time(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">std</span>::tm tm = *<span class="built_in">std</span>::localtime(&amp;t);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Today is           "</span> &lt;&lt; <span class="built_in">std</span>::put_time(&amp;tm, <span class="string">"%c %Z"</span>) &lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    tm.tm_mon -= <span class="number">100</span>;  <span class="comment">// tm_mon is now outside its normal range</span></span><br><span class="line">    <span class="built_in">std</span>::mktime(&amp;tm);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"100 months ago was "</span> &lt;&lt; <span class="built_in">std</span>::put_time(&amp;tm, <span class="string">"%c %Z"</span>) &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Today is           Wed Dec <span class="number">28</span> <span class="number">09</span>:<span class="number">56</span>:<span class="number">10</span> <span class="number">2011</span> EST</span><br><span class="line"><span class="number">100</span> months ago was Thu Aug <span class="number">28</span> <span class="number">10</span>:<span class="number">56</span>:<span class="number">10</span> <span class="number">2003</span> EDT</span><br></pre></td></tr></table></figure></p>
<p>例子参考<a href="http://en.cppreference.com/w/cpp/chrono/c/mktime" target="_blank" rel="external">cppreference.com std::mktime</a></p>
<h3 id="ctime"><a href="#ctime" class="headerlink" title="ctime"></a>ctime</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">ctime</span> <span class="params">(<span class="keyword">const</span> time_t * timer)</span></span>;</span><br></pre></td></tr></table></figure>
<p>转换time_t成人类可读的字符串，是本地时间。<br>这个函数等价：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asctime(localtime(timer))</span><br></pre></td></tr></table></figure></p>
<p>格式如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Www Mmm dd hh:mm:ss yyyy</span><br></pre></td></tr></table></figure></p>
<p>Www是周几，Mmm是月份（字母表示），dd是当月的一天，hh::mm::ss是时间，yyyy是年份<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>      /* printf */</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span>       /* time_t, time, ctime */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">time_t</span> rawtime;</span><br><span class="line"></span><br><span class="line">  time (&amp;rawtime);</span><br><span class="line">  <span class="built_in">printf</span> (<span class="string">"The current local time is: %s"</span>, ctime (&amp;rawtime));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="asctime"><a href="#asctime" class="headerlink" title="asctime"></a>asctime</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">asctime</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">struct</span> tm * timeptr)</span></span>;</span><br></pre></td></tr></table></figure>
<p>转换tm结构体成字符串。<br>这个函数等价：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">asctime</span><span class="params">(<span class="keyword">const</span> <span class="keyword">struct</span> tm *timeptr)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> wday_name[][<span class="number">4</span>] = &#123;</span><br><span class="line">    <span class="string">"Sun"</span>, <span class="string">"Mon"</span>, <span class="string">"Tue"</span>, <span class="string">"Wed"</span>, <span class="string">"Thu"</span>, <span class="string">"Fri"</span>, <span class="string">"Sat"</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> mon_name[][<span class="number">4</span>] = &#123;</span><br><span class="line">    <span class="string">"Jan"</span>, <span class="string">"Feb"</span>, <span class="string">"Mar"</span>, <span class="string">"Apr"</span>, <span class="string">"May"</span>, <span class="string">"Jun"</span>,</span><br><span class="line">    <span class="string">"Jul"</span>, <span class="string">"Aug"</span>, <span class="string">"Sep"</span>, <span class="string">"Oct"</span>, <span class="string">"Nov"</span>, <span class="string">"Dec"</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> result[<span class="number">26</span>];</span><br><span class="line">  <span class="built_in">sprintf</span>(result, <span class="string">"%.3s %.3s%3d %.2d:%.2d:%.2d %d\n"</span>,</span><br><span class="line">    wday_name[timeptr-&gt;tm_wday],</span><br><span class="line">    mon_name[timeptr-&gt;tm_mon],</span><br><span class="line">    timeptr-&gt;tm_mday, timeptr-&gt;tm_hour,</span><br><span class="line">    timeptr-&gt;tm_min, timeptr-&gt;tm_sec,</span><br><span class="line">    <span class="number">1900</span> + timeptr-&gt;tm_year);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>字符串格式同<strong>ctime</strong>。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>      /* printf */</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span>       /* time_t, struct tm, time, localtime, asctime */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">time_t</span> rawtime;</span><br><span class="line">  <span class="keyword">struct</span> tm * timeinfo;</span><br><span class="line"></span><br><span class="line">  time ( &amp;rawtime );</span><br><span class="line">  timeinfo = localtime ( &amp;rawtime );</span><br><span class="line">  <span class="built_in">printf</span> ( <span class="string">"The current date/time is: %s"</span>, asctime (timeinfo) );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="difftime"><a href="#difftime" class="headerlink" title="difftime"></a>difftime</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">difftime</span> <span class="params">(time_t end, time_t beginning)</span></span>;</span><br></pre></td></tr></table></figure>
<p>计算两个时间的差值，单位为秒。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>      /* printf */</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span>       /* time_t, struct tm, difftime, time, mktime */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">time_t</span> now;</span><br><span class="line">  <span class="keyword">struct</span> tm newyear;</span><br><span class="line">  <span class="keyword">double</span> seconds;</span><br><span class="line"></span><br><span class="line">  time(&amp;now);  <span class="comment">/* get current time; same as: now = time(NULL)  */</span></span><br><span class="line"></span><br><span class="line">  newyear = *localtime(&amp;now);</span><br><span class="line"></span><br><span class="line">  newyear.tm_hour = <span class="number">0</span>; newyear.tm_min = <span class="number">0</span>; newyear.tm_sec = <span class="number">0</span>;</span><br><span class="line">  newyear.tm_mon = <span class="number">0</span>;  newyear.tm_mday = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  seconds = difftime(now,mktime(&amp;newyear));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span> (<span class="string">"%.f seconds since new year in the current timezone.\n"</span>, seconds);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="strftime"><a href="#strftime" class="headerlink" title="strftime"></a>strftime</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> strftime (<span class="keyword">char</span>* ptr, <span class="keyword">size_t</span> maxsize, <span class="keyword">const</span> <span class="keyword">char</span>* format,</span><br><span class="line">                 <span class="keyword">const</span> <span class="keyword">struct</span> tm* timeptr );</span><br></pre></td></tr></table></figure>
<p>转换结构体tm为指定字符串<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>      /* puts */</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span>       /* time_t, struct tm, time, localtime, strftime */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">time_t</span> rawtime;</span><br><span class="line">  <span class="keyword">struct</span> tm * timeinfo;</span><br><span class="line">  <span class="keyword">char</span> buffer [<span class="number">80</span>];</span><br><span class="line"></span><br><span class="line">  time (&amp;rawtime);</span><br><span class="line">  timeinfo = localtime (&amp;rawtime);</span><br><span class="line"></span><br><span class="line">  strftime (buffer,<span class="number">80</span>,<span class="string">"Now it's %I:%M%p."</span>,timeinfo);</span><br><span class="line">  <span class="built_in">puts</span> (buffer);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="clock"><a href="#clock" class="headerlink" title="clock"></a>clock</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">clock_t</span> clock (<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure>
<p>返回值是时钟滴答数，时钟滴答是单位时间内的常量，但是是系统指定的，与<strong>CLOCKS_PER_SEC</strong>（每秒内时钟滴答数）相关。</p>
<h3 id="u7EBF_u7A0B_u5B89_u5168"><a href="#u7EBF_u7A0B_u5B89_u5168" class="headerlink" title="线程安全"></a>线程安全</h3><p><strong>ctime</strong>和<strong>asctime</strong>不是线程安全的，原因是返回的字符串指针指向了一个静态分配的字符串，会被后续函数调用复写掉。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** asctime returns a static allocated string shared with other calls</span><br><span class="line">* to asctime or ctime. Every time these functions are called the content</span><br><span class="line">* of the static string is overwritten*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="keyword">time_t</span> t1 = <span class="built_in">std</span>::time(<span class="literal">nullptr</span>);</span><br><span class="line">  <span class="built_in">std</span>::tm* t1_tm = <span class="built_in">std</span>::localtime(&amp;t1);</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* t1_as_text = <span class="built_in">std</span>::asctime(t1_tm); <span class="comment">// save as dangerous string</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"t1 (original)   : "</span> &lt;&lt; t1_as_text &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::seconds(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="keyword">time_t</span> t2 = <span class="built_in">std</span>::time(<span class="literal">nullptr</span>);</span><br><span class="line">  <span class="built_in">std</span>::tm* t2_tm = <span class="built_in">std</span>::localtime(&amp;t2);</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* t2_as_text = <span class="built_in">std</span>::asctime(t2_tm);  <span class="comment">// overwrite t1_as_text</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"t1 (overwritten): "</span> &lt;&lt; t1_as_text;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"t2              : "</span> &lt;&lt; t2_as_text &lt;&lt; <span class="built_in">std</span>::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t1 (original) : Mon Jan <span class="number">21</span> <span class="number">13</span>:<span class="number">56</span>:<span class="number">30</span> <span class="number">2013</span></span><br><span class="line"></span><br><span class="line">t1 (overwrite): Mon Jan <span class="number">21</span> <span class="number">13</span>:<span class="number">56</span>:<span class="number">35</span> <span class="number">2013</span></span><br><span class="line">t2            : Mon Jan <span class="number">21</span> <span class="number">13</span>:<span class="number">56</span>:<span class="number">35</span> <span class="number">2013</span></span><br></pre></td></tr></table></figure></p>
<p>在Linux系统下，可以使用<code>ctime_r</code>和<code>asctime_r</code>这两个线程安全的函数，它们线程安全的原因是使用了用户自己分配的buffer，这个buffer至少有26字节的空间。<br>在Windows系统下，可以使用<code>ctime_s</code>和<code>asctime_s</code>这两个函数。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">ctime_r</span><span class="params">(<span class="keyword">const</span> time_t *timep, <span class="keyword">char</span> *buf)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">asctime_r</span><span class="params">(<span class="keyword">const</span> <span class="keyword">struct</span> tm *tm, <span class="keyword">char</span> *buf)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">errno_t</span> ctime_s(</span><br><span class="line">   <span class="keyword">char</span>* buffer,</span><br><span class="line">   <span class="keyword">size_t</span> numberOfElements,</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">time_t</span> *time</span><br><span class="line">);</span><br><span class="line"><span class="keyword">errno_t</span> asctime_s(</span><br><span class="line">   <span class="keyword">char</span>* buffer,</span><br><span class="line">   <span class="keyword">size_t</span> numberOfElements,</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">struct</span> tm *_tm</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p><strong>localtime</strong>和<strong>gmtime</strong>也不是线程安全的。原因是，返回的std::tm指针在内部指向了静态的std::tm结构。<br>在Linux系统下，可以使用<code>localtime_r</code>和<code>gmtime_r</code>这两个线程安全的函数。<br>在Windows系统下，可以使用<code>localtime_s</code>和<code>gmtime_s</code>这两个函数。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">struct</span> tm *<span class="title">localtime_r</span><span class="params">(<span class="keyword">const</span> time_t *timep, <span class="keyword">struct</span> tm *result)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">struct</span> tm *<span class="title">gmtime_r</span><span class="params">(<span class="keyword">const</span> time_t *timep, <span class="keyword">struct</span> tm *result)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">errno_t</span> localtime_s(</span><br><span class="line">   <span class="keyword">struct</span> tm* _tm,</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">time_t</span> *time</span><br><span class="line">);</span><br><span class="line"><span class="keyword">errno_t</span> gmtime_s(</span><br><span class="line">   <span class="keyword">struct</span> tm* _tm,</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">__time_t</span>* time</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>为了跨平台并且多线程使用这些功能，下面定义安全的版本<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> g2&#123;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::chrono::time_point&lt;<span class="built_in">std</span>::chrono::system_clock&gt;  system_time_point;</span><br><span class="line"></span><br><span class="line"><span class="function">tm <span class="title">localtime</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::time_t&amp; time)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::tm tm_snapshot;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> (defined(WIN32) || defined(_WIN32) || defined(__WIN32__))</span></span><br><span class="line">  localtime_s(&amp;tm_snapshot, &amp;time);</span><br><span class="line"><span class="preprocessor">#<span class="keyword">else</span></span></span><br><span class="line">  localtime_r(&amp;time, &amp;tm_snapshot); <span class="comment">// POSIX</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="keyword">return</span> tm_snapshot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// To simplify things the return value is just a string. I.e. by design!</span></span><br><span class="line"><span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">put_time</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::tm* date_time, <span class="keyword">const</span> <span class="keyword">char</span>* c_time_format)</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">if</span> (defined(WIN32) || defined(_WIN32) || defined(__WIN32__))</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">ostringstream</span> oss;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// BOGUS hack done for VS2012: C++11 non-conformant since it SHOULD take a "const struct tm*  "</span></span><br><span class="line">  <span class="comment">// ref. C++11 standard: ISO/IEC 14882:2011, § 27.7.1,</span></span><br><span class="line">  oss &lt;&lt; <span class="built_in">std</span>::put_time(<span class="keyword">const_cast</span>&lt;<span class="built_in">std</span>::tm*&gt;(date_time), c_time_format);</span><br><span class="line">  <span class="keyword">return</span> oss.str();</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">else</span>    <span class="comment">// LINUX</span></span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">size_t</span> size = <span class="number">1024</span>;</span><br><span class="line">  <span class="keyword">char</span> buffer[size];</span><br><span class="line">  <span class="keyword">auto</span> success = <span class="built_in">std</span>::strftime(buffer, size, c_time_format, date_time);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="number">0</span> == success)</span><br><span class="line">    <span class="keyword">return</span> c_time_format;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> buffer;</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// extracting std::time_t from std:chrono for "now"</span></span><br><span class="line"><span class="built_in">std</span>::<span class="keyword">time_t</span> systemtime_now()</span><br><span class="line">&#123;</span><br><span class="line">  system_time_point system_now = <span class="built_in">std</span>::chrono::system_clock::now();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::chrono::system_clock::<span class="keyword">to_time_t</span>(system_now);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// g2-namespace</span></span><br></pre></td></tr></table></figure></p>
<p>参考<a href="https://kjellkod.wordpress.com/2013/01/22/exploring-c11-part-2-localtime-and-time-again/" target="_blank" rel="external">Exploring C++11, part 2 (localtime and time again)</a></p>
<h3 id="C_u98CE_u683C_u65F6_u95F4_u51FD_u6570_u4E0E_u65F6_u533A_u5173_u7CFB"><a href="#C_u98CE_u683C_u65F6_u95F4_u51FD_u6570_u4E0E_u65F6_u533A_u5173_u7CFB" class="headerlink" title="C风格时间函数与时区关系"></a>C风格时间函数与时区关系</h3><p><img src="./images/time%20zone.png" alt="enter description here" title="time zone.png"></p>
<h2 id="std_3A_3Achrono_u65F6_u95F4_u5E93"><a href="#std_3A_3Achrono_u65F6_u95F4_u5E93" class="headerlink" title="std::chrono时间库"></a>std::chrono时间库</h2><p>要使用chrono库，需要<code>#include&lt;chrono&gt;</code>，其所有实现均在std::chrono namespace中。这个库定义了三个主要类型：</p>
<ul>
<li><strong>Durations</strong> 用于测量时间跨度。像1分钟，2小时或者10毫秒。在这个库中，它们由<code>duration</code>类模板对象表示，它们由计数（count representation）和时间单位（period precision）组成，例如10毫秒由10这个计数和毫秒这个时间单位组成。</li>
<li><strong>Time points</strong> 代表一个特定的时间点，像某人的生日，下一趟火车的经过时间。在这个库中，<code>time_point</code>类模板的对象靠使用相对于epoch的<code>duration</code>来表示时间点。</li>
<li><strong>Clocks</strong> 一个将时间点关联到真实物理时间的框架。一个时钟包含一个开始时间点（例如1970年1月1日）和计时周期（例如秒）。这个库提供了至少3个时钟，这些时钟提供了以<code>time_point</code>表示当前时间的方法。有<code>system_clock</code>, <code>steady_clock</code>和<code>high_resolution_clock</code>.</li>
</ul>
<h3 id="duration"><a href="#duration" class="headerlink" title="duration"></a>duration</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Rep, <span class="keyword">class</span> Period = ratio&lt;<span class="number">1</span>&gt; &gt;</span><br><span class="line"><span class="keyword">class</span> duration;</span><br></pre></td></tr></table></figure>
<p><strong>Rep</strong>是一个算术类型，或者一个具有算法运算的类，用于表示计数。<br><strong>Period</strong>是一个ratio类型，表示以秒为单位的周期。</p>
<p>成员函数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">count() <span class="comment">//返回计数，时间单位不一定是秒</span></span><br><span class="line">operators() <span class="comment">//各种算术运算</span></span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>type</th>
<th>Representation</th>
<th>Period</th>
</tr>
</thead>
<tbody>
<tr>
<td>hours</td>
<td>signed integral type of at least 23 bits</td>
<td>ratio<3600,1></3600,1></td>
</tr>
<tr>
<td>minutes</td>
<td>signed integral type of at least 29 bits</td>
<td>ratio<60,1></60,1></td>
</tr>
<tr>
<td>seconds</td>
<td>signed integral type of at least 35 bits</td>
<td>ratio<1,1></1,1></td>
</tr>
<tr>
<td>milliseconds</td>
<td>signed integral type of at least 45 bits</td>
<td>ratio<1,1000></1,1000></td>
</tr>
<tr>
<td>microseconds</td>
<td>signed integral type of at least 55 bits</td>
<td>ratio<1,1000000></1,1000000></td>
</tr>
<tr>
<td>nanoseconds</td>
<td>signed integral type of at least 64 bits</td>
<td>ratio<1,1000000000></1,1000000000></td>
</tr>
</tbody>
</table>
<p>这里说明一下<code>ratio</code>类型<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">intmax_t</span> N, <span class="keyword">intmax_t</span> D = <span class="number">1</span>&gt; <span class="keyword">class</span> ratio;</span><br></pre></td></tr></table></figure></p>
<p>这个模板类能在编译时计算有理数。<br><strong>N</strong>是分子，<strong>D</strong>是分母，<code>ratio&lt;1,1000&gt;</code>表示单位时间是毫秒。</p>
<h3 id="system_clock"><a href="#system_clock" class="headerlink" title="system_clock"></a>system_clock</h3><p>是一个系统时钟。</p>
<ul>
<li>真实时间<br>它被用于表示真实时间，因此它可以和time_t进行转换。</li>
<li>有符号的计数<br>它的<code>time_point</code>可以表示epoch前的时间（负值）。</li>
<li>系统级<br>运行在系统中的所有程序会得到同样的<code>time_point</code>值。</li>
</ul>
<p>成员函数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">now() <span class="comment">//获取当前时间time_point</span></span><br><span class="line"><span class="keyword">to_time_t</span>() <span class="comment">//将time_point转换成time_t秒</span></span><br><span class="line"><span class="keyword">from_time_t</span>() <span class="comment">//将time_t转换成time_point</span></span><br></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;ratio&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="built_in">std</span>::chrono::system_clock;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::chrono::duration&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::ratio&lt;<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>&gt; &gt; one_day (<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  system_clock::time_point today = system_clock::now();</span><br><span class="line">  system_clock::time_point tomorrow = today + one_day;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="keyword">time_t</span> tt;</span><br><span class="line"></span><br><span class="line">  tt = system_clock::<span class="keyword">to_time_t</span> ( today );</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"today is: "</span> &lt;&lt; ctime(&amp;tt);</span><br><span class="line"></span><br><span class="line">  tt = system_clock::<span class="keyword">to_time_t</span> ( tomorrow );</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"tomorrow will be: "</span> &lt;&lt; ctime(&amp;tt);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="steady_clock"><a href="#steady_clock" class="headerlink" title="steady_clock"></a>steady_clock</h3><p>稳定时钟，表示一个单调递增时钟，它与系统时钟（wall clock time)无关，如果修改了系统时间，也不会影响到此时钟。适用于测量时间间隔，例如算法计时。</p>
<p>成员函数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">now() <span class="comment">//获取当前时间点</span></span><br></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;ratio&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::chrono;</span><br><span class="line"></span><br><span class="line">  steady_clock::time_point t1 = steady_clock::now();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"printing out 1000 stars...\n"</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">1000</span>; ++i) <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"*"</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::endl;</span><br><span class="line"></span><br><span class="line">  steady_clock::time_point t2 = steady_clock::now();</span><br><span class="line"></span><br><span class="line">  duration&lt;<span class="keyword">double</span>&gt; time_span = duration_cast&lt;duration&lt;<span class="keyword">double</span>&gt;&gt;(t2 - t1);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"It took me "</span> &lt;&lt; time_span.count() &lt;&lt; <span class="string">" seconds."</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::endl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="high_resolution_clock"><a href="#high_resolution_clock" class="headerlink" title="high_resolution_clock"></a>high_resolution_clock</h3><p>高精度时钟，是一个拥有最短计时周期的时钟，是<code>system_clock</code>或者<code>steady_clock</code>的别名。</p>
<p>成员函数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">now() <span class="comment">//获取当前时间点</span></span><br></pre></td></tr></table></figure></p>
<h3 id="time_point"><a href="#time_point" class="headerlink" title="time_point"></a>time_point</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Clock, <span class="keyword">class</span> Duration = <span class="keyword">typename</span> Clock::duration&gt;</span><br><span class="line">  <span class="keyword">class</span> time_point;</span><br></pre></td></tr></table></figure>
<p>是一个时间点，是从特定时钟的纪元时间（起始时间，一个时间参考点）开始的时间长度。内部存储了一个<code>duration</code>类型的对象，并使用<code>Clock</code>类型作为纪元时间的参考。</p>
<p>成员函数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">time_since_epoch() <span class="comment">//返回从它的时钟纪元时间开始到当前时间点的duration时间（时间段）</span></span><br><span class="line">operators <span class="comment">//各种算式运算操作和关系运算操作</span></span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：两个<code>time_point</code>相减，得到<code>duration</code>类型。</p>
<p>示例：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::chrono::system_clock::time_point now = <span class="built_in">std</span>::chrono::system_clock::now();</span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">time_t</span> now_c = <span class="built_in">std</span>::chrono::system_clock::<span class="keyword">to_time_t</span>(now - <span class="built_in">std</span>::chrono::hours(<span class="number">24</span>));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"24 hours ago, the time was "</span></span><br><span class="line">              &lt;&lt; <span class="built_in">std</span>::put_time(<span class="built_in">std</span>::localtime(&amp;now_c), <span class="string">"%F %T"</span>) &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::chrono::steady_clock::time_point start = <span class="built_in">std</span>::chrono::steady_clock::now();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello World\n"</span>;</span><br><span class="line">    <span class="built_in">std</span>::chrono::steady_clock::time_point end = <span class="built_in">std</span>::chrono::steady_clock::now();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Printing took "</span></span><br><span class="line">              &lt;&lt; <span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::microseconds&gt;(end - start).count()</span><br><span class="line">              &lt;&lt; <span class="string">"us.\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u5176_u5B83_u8F85_u52A9_u51FD_u6570"><a href="#u5176_u5B83_u8F85_u52A9_u51FD_u6570" class="headerlink" title="其它辅助函数"></a>其它辅助函数</h3><h4 id="time_point_cast"><a href="#time_point_cast" class="headerlink" title="time_point_cast"></a>time_point_cast</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ToDuration, <span class="keyword">class</span> Clock, <span class="keyword">class</span> Duration&gt;</span><br><span class="line">  time_point&lt;Clock,ToDuration&gt; time_point_cast (<span class="keyword">const</span> time_point&lt;Clock,Duration&gt;&amp; tp);</span><br></pre></td></tr></table></figure>
<p>转换time_point从一个<code>duration</code>到另一个<code>duration</code>。相当于转换了time_point的时间单位。<br><strong>注意</strong>：此函数的模板参数是<code>duration</code>类型，而不是<code>time_point</code>类型。</p>
<p>示例：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;ratio&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::chrono;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">typedef</span> duration&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::ratio&lt;<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>&gt;&gt; days_type;</span><br><span class="line"></span><br><span class="line">  time_point&lt;system_clock,days_type&gt; today = time_point_cast&lt;days_type&gt;(system_clock::now());</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; today.time_since_epoch().count() &lt;&lt; <span class="string">" days since epoch"</span> &lt;&lt; <span class="built_in">std</span>::endl; <span class="comment">// 15490 days since epoch</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="duration_cast"><a href="#duration_cast" class="headerlink" title="duration_cast"></a>duration_cast</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ToDuration, <span class="keyword">class</span> Rep, <span class="keyword">class</span> Period&gt;</span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> ToDuration <span class="title">duration_cast</span> <span class="params">(<span class="keyword">const</span> duration&lt;Rep,Period&gt;&amp; dtn)</span></span>;</span><br></pre></td></tr></table></figure>
<p>功能与<code>time_point_cast</code>一样，只是作用的对象是<code>duration</code>类型。</p>
<p>示例：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span>     // std::cout</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span>       // std::chrono::seconds, std::chrono::milliseconds</span></span><br><span class="line">                        <span class="comment">// std::chrono::duration_cast</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::chrono::<span class="function">seconds <span class="title">s</span> <span class="params">(<span class="number">1</span>)</span></span>;             <span class="comment">// 1 second</span></span><br><span class="line">  <span class="built_in">std</span>::chrono::milliseconds ms = <span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::milliseconds&gt; (s);</span><br><span class="line"></span><br><span class="line">  ms += <span class="built_in">std</span>::chrono::milliseconds(<span class="number">2500</span>);  <span class="comment">// 2500 millisecond</span></span><br><span class="line"></span><br><span class="line">  s = <span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::seconds&gt; (ms);   <span class="comment">// truncated</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"ms: "</span> &lt;&lt; ms.count() &lt;&lt; <span class="built_in">std</span>::endl; <span class="comment">//ms: 3500</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"s: "</span> &lt;&lt; s.count() &lt;&lt; <span class="built_in">std</span>::endl; <span class="comment">//s: 3</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><p><code>durationS</code>代表了一个时间跨度，即多少个时间单位。<br><code>time_pointS</code>代表了从一个时间参考点开始经历了多长时间，是一个时间点。例如，开机后3小时，从计时器开始后的3秒钟等等。其中时间参考点由<code>clockS</code>提供，时长由<code>duration</code>表示。当两个时间点拥有同样的时间参考点，就可以进行比较和计算。<br><code>clockS</code>代表一个现实时钟，提供参考时间点和计时周期组成。可以自定义<code>clock</code>。<code>now</code>函数返回当前时间点<code>time_point</code>。<br><code>clockS</code>和<code>time_pointS</code>它们之间紧密的相互联系和引用的。</p>
<p><img src="./images/chrono.png" alt="三者之间的关系和不同时钟的关系" title="chrono.png"></p>
<h3 id="u683C_u5F0F_u5316_u65F6_u95F4"><a href="#u683C_u5F0F_u5316_u65F6_u95F4" class="headerlink" title="格式化时间"></a>格式化时间</h3><p>格式化时间除了前面提到的<code>ctime</code>和<code>asctime</code>函数外，还有<code>std::strftime</code>和<code>std::put_time</code>，这两个函数可以自定义格式。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt; <span class="keyword">class</span> CharT &gt;</span><br><span class="line"><span class="comment">/*unspecified*/</span> put_time( <span class="keyword">const</span> <span class="built_in">std</span>::tm* tmb, <span class="keyword">const</span> CharT* fmt );</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="keyword">size_t</span> strftime( <span class="keyword">char</span>* str, <span class="built_in">std</span>::<span class="keyword">size_t</span> count, <span class="keyword">const</span> <span class="keyword">char</span>* format, <span class="keyword">const</span> <span class="built_in">std</span>::tm* time );</span><br></pre></td></tr></table></figure></p>
<p><code>std::put_time</code>在使用上比<code>strftime</code>方便，可以直接输出到stream中<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::put_time(ptm,<span class="string">"%c"</span>) &lt;&lt; endl;</span><br></pre></td></tr></table></figure></p>
<h4 id="time_point_u683C_u5F0F_u5316"><a href="#time_point_u683C_u5F0F_u5316" class="headerlink" title="time_point格式化"></a><code>time_point</code>格式化</h4><p><code>time_point</code>不能直接输出到stream中，需要转换成<code>std::time_t</code>或者<code>std::tm</code>，使用<code>ctime</code>、<code>asctime</code>、<code>strftime</code>或者<code>std::put_time</code>格式化成字符串。</p>
<p>示例：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">system_clock::time_point today = system_clock::now();</span><br><span class="line"><span class="keyword">time_t</span> tt;</span><br><span class="line"></span><br><span class="line">tt = system_clock::<span class="keyword">to_time_t</span> ( today );</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"today is: "</span> &lt;&lt; ctime(&amp;tt);</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"today is: "</span></span><br><span class="line">              &lt;&lt; <span class="built_in">std</span>::put_time(<span class="built_in">std</span>::localtime(&amp;tt), <span class="string">"%F %T"</span>) &lt;&lt; <span class="string">'\n'</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="boost_u65F6_u95F4_u5E93"><a href="#boost_u65F6_u95F4_u5E93" class="headerlink" title="boost时间库"></a>boost时间库</h2><p>这里只是简单列了一些比较重要的类和函数，没有面面俱到，详细说明可以参考<a href="http://www.boost.org/doc/libs/master/doc/html/date_time.html" target="_blank" rel="external">Boost.Date_Time</a></p>
<h3 id="Chrono"><a href="#Chrono" class="headerlink" title="Chrono"></a>Chrono</h3><p>这个库实现了C++11中新的时间工具，这个工具提出在<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2661.htm" target="_blank" rel="external">N2661 - A Foundation to Sleep On</a>。<br>这个库除了实现了标准库中Chrono的标准功能外，还增加了很多其它功能，而且多了几个clock。</p>
<h3 id="Date_Time"><a href="#Date_Time" class="headerlink" title="Date_Time"></a>Date_Time</h3><h4 id="Gregorian"><a href="#Gregorian" class="headerlink" title="Gregorian"></a>Gregorian</h4><p>是一个基于公历的日期库，Boost.DateTime支持由1400年至9999年的历法日期。<br>所有gregorian类型都在<code>boost::gregorian</code>命名空间下。没有input/output依赖的类包含在<code>boost/date_time/gregorian/gregorian_types.hpp</code>中，<code>boost/date_time/gregorian/gregorian.hpp</code>包含所有类型和input/output代码。<br>主要类型：<code>date</code>、<code>date_duration</code>、<code>date_period</code>、<code>date_iterator</code></p>
<h5 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h5><p><code>date</code>代表了一个日期，由年、月、日组成。<br>它可以从年月日构造<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date(greg_year, greg_month, greg_day)</span><br></pre></td></tr></table></figure></p>
<p>从字符串构造<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">date from_string(std::string)</span><br><span class="line">date from_undelimited_string(std::string)</span><br><span class="line"></span><br><span class="line">std::string ds("2002/1/25");</span><br><span class="line">date d(from_string(ds));</span><br><span class="line"></span><br><span class="line">std::string ds("20020125");</span><br><span class="line">date d(from_undelimited_string(ds));</span><br></pre></td></tr></table></figure></p>
<p>从clock构造<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date d(day_clock::local_day()); //Get the local day based on the time zone settings of the computer.</span><br><span class="line">date d(day_clock::universal_day()); //Get the UTC day.</span><br></pre></td></tr></table></figure></p>
<p>从结构体tm创建<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tm d_tm;</span><br><span class="line">d_tm.tm_year = <span class="number">105</span>;</span><br><span class="line">d_tm.tm_mon  = <span class="number">0</span>;</span><br><span class="line">d_tm.tm_mday = <span class="number">1</span>;</span><br><span class="line">date d = date_from_tm(d_tm);</span><br><span class="line"><span class="comment">// d =&gt; 2005-Jan-01</span></span><br></pre></td></tr></table></figure></p>
<p>可以转换成字符串<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::string to_simple_string(date d) //"2002-Jan-01"</span><br><span class="line">std::string to_iso_string(date d) //"20020131"</span><br><span class="line">std::string to_iso_extended_string(date d) //"2002-01-31"</span><br></pre></td></tr></table></figure></p>
<p>可以转换成结构体tm<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">date <span class="title">d</span><span class="params">(<span class="number">2005</span>,Jan,<span class="number">1</span>)</span></span>;</span><br><span class="line">tm d_tm = to_tm(d);</span><br><span class="line"><span class="comment">/* tm_year =&gt; 105</span><br><span class="line">   tm_mon  =&gt; 0</span><br><span class="line">   tm_mday =&gt; 1</span><br><span class="line">   tm_wday =&gt; 6 (Saturday)</span><br><span class="line">   tm_yday =&gt; 0</span><br><span class="line">   tm_hour =&gt; 0</span><br><span class="line">   tm_min  =&gt; 0</span><br><span class="line">   tm_sec  =&gt; 0</span><br><span class="line">   tm_isddst =&gt; -1 */</span></span><br></pre></td></tr></table></figure></p>
<p>能进行加减算术运算和逻辑运算。</p>
<h5 id="Date_Duration"><a href="#Date_Duration" class="headerlink" title="Date Duration"></a>Date Duration</h5><p><code>boost::gregorian::date_duration</code>表示时间长度，被用做的<code>gregorian::date</code>的算术运算，可正可负。<br><code>boost::gregorian::date_duration</code>被<code>typedef</code>成<code>days</code>。<br>这里还包括其它duration类型：<code>months</code>，<code>years</code>，<code>weeks</code>。</p>
<h5 id="Date_Period"><a href="#Date_Period" class="headerlink" title="Date Period"></a>Date Period</h5><p><code>boost::gregorian::date_period</code>表示两个日期之间的区间。利用它可以检测某个日期是否在某个假日或者周末内，可以计算一个时间区间与另一个时间区间的交集或者并集等。<br>可以用两个日期或者一个日期和一个时间长度进行构造:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">date_period dp(date(2002,Jan,10),</span><br><span class="line">               date(2002,Jan,12));</span><br><span class="line">date_period dp(date(2002,Jan,10),</span><br><span class="line">               days(2));</span><br></pre></td></tr></table></figure></p>
<h4 id="Posix_Time"><a href="#Posix_Time" class="headerlink" title="Posix Time"></a>Posix Time</h4><p>定义了一个非调节的时间系统，这个系统具有纳秒/毫秒精度和稳定计算的特性。对于<code>ptime</code>，纳秒精度下使用96 bits存储，毫秒精度下使用64 bits存储。这个时间系统使用公历（Gregrorian calendar)去表示时间中的日期部分。</p>
<h5 id="Ptime"><a href="#Ptime" class="headerlink" title="Ptime"></a>Ptime</h5><p><code>boost::posix_time::ptime</code>表示一个与时区无关的时间点，日期部分依赖于<code>gregorian::date</code>。<br>使用日期加时间偏移构造：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ptime t1(date(2002,Jan,10),</span><br><span class="line">         time_duration(1,2,3));</span><br><span class="line">ptime t2(date(2002,Jan,10),</span><br><span class="line">         hours(1)+nanosec(5));</span><br></pre></td></tr></table></figure></p>
<p>从字符串创建：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::string ts("2002-01-20 23:59:59.000");</span><br><span class="line">ptime t(time_from_string(ts))</span><br><span class="line"></span><br><span class="line">std::string ts("20020131T235959");</span><br><span class="line">ptime t(from_iso_string(ts))</span><br></pre></td></tr></table></figure></p>
<p>从时钟构造：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ptime t(second_clock::local_time()); //本地时间</span><br><span class="line"></span><br><span class="line">ptime t(second_clock::universal_time()) //UTC时间</span><br><span class="line"></span><br><span class="line">ptime t(microsec_clock::local_time());</span><br><span class="line"></span><br><span class="line">ptime t(microsec_clock::universal_time());</span><br></pre></td></tr></table></figure></p>
<p>使用转换函数创建：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//time_t -&gt; ptime</span></span><br><span class="line"><span class="function">ptime <span class="title">from_time_t</span><span class="params">(time_t t)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//FILETIEM -&gt; ptime</span></span><br><span class="line">ptime from_ftime&lt;ptime&gt;(FILETIME ft);</span><br><span class="line"></span><br><span class="line"><span class="comment">//tm -&gt; ptime</span></span><br><span class="line"><span class="function">ptime <span class="title">ptime_from_tm</span><span class="params">(tm timetm)</span></span><br><span class="line"></span><br><span class="line">tm pt_tm</span>;</span><br><span class="line">pt_tm.tm_year = <span class="number">105</span>;</span><br><span class="line">pt_tm.tm_mon  = <span class="number">0</span>;</span><br><span class="line">pt_tm.tm_mday = <span class="number">1</span>;</span><br><span class="line">pt_tm.tm_hour = <span class="number">1</span>;</span><br><span class="line">pt_tm.tm_min  = <span class="number">2</span>;</span><br><span class="line">pt_tm.tm_sec  = <span class="number">3</span>;</span><br><span class="line">ptime pt = ptime_from_tm(pt_tm);</span><br><span class="line"><span class="comment">// pt =&gt; 2005-Jan-01 01:02:03</span></span><br></pre></td></tr></table></figure></p>
<p>转换成字符串<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::string to_simple_string(ptime) //2002-Jan-01 10:00:01.123456789</span><br><span class="line"></span><br><span class="line">std::string to_iso_string(ptime)  //20020131T100001,123456789</span><br><span class="line"></span><br><span class="line">std::string to_iso_extended_string(ptime) //2002-01-31T10:00:01,123456789</span><br></pre></td></tr></table></figure></p>
<p>转换成结构体tm<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ptime pt(date(2005,Jan,1), time_duration(1,2,3));</span><br><span class="line">tm pt_tm = to_tm(pt);</span><br><span class="line">/* tm_year =&gt; 105</span><br><span class="line">   tm_mon  =&gt; 0</span><br><span class="line">   tm_mday =&gt; 1</span><br><span class="line">   tm_wday =&gt; 6 (Saturday)</span><br><span class="line">   tm_yday =&gt; 0</span><br><span class="line">   tm_hour =&gt; 1</span><br><span class="line">   tm_min  =&gt; 2</span><br><span class="line">   tm_sec  =&gt; 3</span><br><span class="line">   tm_isddst =&gt; -1 */</span><br></pre></td></tr></table></figure></p>
<h5 id="Time_Duration"><a href="#Time_Duration" class="headerlink" title="Time Duration"></a>Time Duration</h5><p><code>boost::posix_time::time_duration</code>代表时间长度，可正可负。<br>下面展示了几个继承自<code>time_duration</code>的辅助类：<br><img src="./images/time_duration_inherit.png" alt="time_duration_inherit" title="time_duration_inherit.png"><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> boost::posix_time;</span><br><span class="line"></span><br><span class="line">time_duration td = hours(<span class="number">1</span>) + seconds(<span class="number">10</span>); <span class="comment">//01:00:01</span></span><br><span class="line">td = hours(<span class="number">1</span>) + nanoseconds(<span class="number">5</span>); <span class="comment">//01:00:00.000000005</span></span><br></pre></td></tr></table></figure></p>
<p>构造函数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">time_duration(hours,</span><br><span class="line">              minutes,</span><br><span class="line">              seconds,</span><br><span class="line">              fractional_seconds)</span><br></pre></td></tr></table></figure></p>
<p>可以使用<code>hours</code>,<code>minutes</code>,<code>seconds</code>,<code>milliseconds</code>,<code>microseconds</code>,<code>nanoseconds</code>来构造：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">time_duration td = hours(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">time_duration td = milliseconds(<span class="number">3</span>);</span><br></pre></td></tr></table></figure></p>
<p>从字符串创建：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::string ts("23:59:59.000");</span><br><span class="line">time_duration td(duration_from_string(ts));</span><br></pre></td></tr></table></figure></p>
<p>转换成结构体tm：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">time_duration <span class="title">td</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span></span>;</span><br><span class="line">tm td_tm = to_tm(td);</span><br><span class="line"><span class="comment">/* tm_year =&gt; 0</span><br><span class="line">   tm_mon  =&gt; 0</span><br><span class="line">   tm_mday =&gt; 0</span><br><span class="line">   tm_wday =&gt; 0</span><br><span class="line">   tm_yday =&gt; 0</span><br><span class="line">   tm_hour =&gt; 1</span><br><span class="line">   tm_min  =&gt; 2</span><br><span class="line">   tm_sec  =&gt; 3</span><br><span class="line">   tm_isddst =&gt; -1 */</span></span><br></pre></td></tr></table></figure></p>
<h5 id="Time_Period"><a href="#Time_Period" class="headerlink" title="Time Period"></a>Time Period</h5><p><code>boost::posix_time::time_period</code>表示两个时间的区间。类似于<code>date_period</code>。</p>
<p>用两个时间点来构造：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">date d(2002,Jan,01);</span><br><span class="line">ptime t1(d, seconds(10)); //10 sec after midnight</span><br><span class="line">ptime t2(d, hours(10)); //10 hours after midnight</span><br><span class="line">time_period tp(t1, t2); //Create a period as [begin, end). If end is &lt;= begin then the period will be defined as invalid.</span><br><span class="line"></span><br><span class="line">date d(2002,Jan,01);</span><br><span class="line">ptime t(d, seconds(10)); //10 sec after midnight</span><br><span class="line">time_period tp(t, hours(3)); //Create a period as [begin, begin+len) where end would be begin+len. If len is &lt;= zero then the period will be defined as invalid.</span><br></pre></td></tr></table></figure></p>
<h4 id="Local_Time"><a href="#Local_Time" class="headerlink" title="Local Time"></a>Local Time</h4><p>这个库包括四个主要的本地时间管理扩展。<br><code>local_date_time</code>本地时间<br><code>posix_time_zone</code>由posix字符串（”EST10EDT,M10.5.0,M3.5.0/03”）定义的时区<br><code>time_zone_database</code>从.csv文件中用区域获取时区<br><code>time_zone</code>抽象的时区接口</p>
<p>这些扩展定义了一个用于调整时间到本地时区的时间系统。这个时间系统使用了posix_time系统的所有特性和优点。<code>time_zone</code>包含用于时区转换的所有必要数据/规则。</p>
<h5 id="Time_Zone_uFF08_u62BD_u8C61_uFF09"><a href="#Time_Zone_uFF08_u62BD_u8C61_uFF09" class="headerlink" title="Time Zone（抽象）"></a>Time Zone（抽象）</h5><p><code>time_zone_base</code>是表示时区的一个抽象基类模板。<code>date_time</code>库靠<code>boost::shared_ptr&lt;time_zone_base&gt;</code>来处理时区。为了使用方便，<code>time_zone_base</code>被<code>typedef</code>成<code>time_zone</code>。</p>
<h5 id="Posix_Time_Zone"><a href="#Posix_Time_Zone" class="headerlink" title="Posix Time Zone"></a>Posix Time Zone</h5><p>一个<code>posix_time_zone</code>对象包含一个时区的数据和规则，像距离UTC时间的偏移、名称、缩写和夏令时规则。</p>
<h5 id="Time_Zone_Database"><a href="#Time_Zone_Database" class="headerlink" title="Time Zone Database"></a>Time Zone Database</h5><p>本地时间系统依赖于时区信息的存储。时区数据库就是用来存储这些数据的。</p>
<h5 id="Local_Date_Time"><a href="#Local_Date_Time" class="headerlink" title="Local Date Time"></a>Local Date Time</h5><p><code>local_date_time</code>就是一个时间点和对应的时区。时间在内部用UTC表示。</p>
<p>从clock构造：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">time_zone_ptr zone(</span><br><span class="line">  new posix_time_zone("MST-07")</span><br><span class="line">);</span><br><span class="line">local_date_time ldt =</span><br><span class="line">  local_microsec_clock::local_time(</span><br><span class="line">    zone);</span><br><span class="line"></span><br><span class="line">time_zone_ptr zone(</span><br><span class="line">  new posix_time_zone("MST-07")</span><br><span class="line">);</span><br><span class="line">local_date_time ldt =</span><br><span class="line">  local_sec_clock::local_time(zone);</span><br></pre></td></tr></table></figure></p>
<p>从ptime构造：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 3am, 2004-Nov-05 local time</span><br><span class="line">ptime pt(date(2004,Nov,5),</span><br><span class="line">         hours(10));</span><br><span class="line">time_zone_ptr zone(</span><br><span class="line">  new posix_time_zone("MST-07"));</span><br><span class="line">local_date_time az(pt, zone);</span><br></pre></td></tr></table></figure></p>
<p>转换成结构体tm：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 6am, 2005-Jul-05 local time</span><br><span class="line">std::string z("EST-05EDT,M4.1.0,M10.1.0");</span><br><span class="line">ptime pt(date(2005,Jul,5),</span><br><span class="line">         hours(10));</span><br><span class="line">time_zone_ptr zone( new posix_time_zone(z));</span><br><span class="line">local_date_time ldt(pt, zone);</span><br><span class="line">tm ldt_tm = to_tm(ldt);</span><br><span class="line">/* tm_year =&gt; 105</span><br><span class="line">   tm_mon  =&gt; 6</span><br><span class="line">   tm_mday =&gt; 5</span><br><span class="line">   tm_wday =&gt; 2 (Tuesday)</span><br><span class="line">   tm_yday =&gt; 185</span><br><span class="line">   tm_hour =&gt; 6</span><br><span class="line">   tm_min  =&gt; 0</span><br><span class="line">   tm_sec  =&gt; 0</span><br><span class="line">   tm_isddst =&gt; 1 */</span><br></pre></td></tr></table></figure></p>
<h5 id="Local_Time_Period"><a href="#Local_Time_Period" class="headerlink" title="Local Time Period"></a>Local Time Period</h5><p><code>boost::local_time::local_time_period</code>表示两个本地时间的区间，与<code>date_period</code>和<code>time_period</code>类似。</p>
<h4 id="Date_Time_Input/Output"><a href="#Date_Time_Input/Output" class="headerlink" title="Date Time Input/Output"></a>Date Time Input/Output</h4><p><code>IO streaming system</code>给用户提供了灵活的日期和时间展示方式。其自定义项分为两部分：格式化标识和字符串元素。格式化标识提供了日期元素和日期类型的组织顺序上的灵活性，自定义字符串元素允许替换内建的月份名称、周名称等其它IO内建的字符串。<br>输出系统基于<code>date_facet</code>（派生自<code>std::facet</code>），输入系统基于<code>date_input_facet</code>。</p>
<h5 id="IO_u5BF9_u8C61"><a href="#IO_u5BF9_u8C61" class="headerlink" title="IO对象"></a>IO对象</h5><table>
<thead>
<tr>
<th>Output</th>
<th>Input</th>
</tr>
</thead>
<tbody>
<tr>
<td>date_facet</td>
<td>date_input_facet</td>
</tr>
<tr>
<td>wdate_facet</td>
<td>wdate_input_facet</td>
</tr>
<tr>
<td>time_facet</td>
<td>time_input_facet</td>
</tr>
<tr>
<td>wtime_facet</td>
<td>wtime_input_facet</td>
</tr>
<tr>
<td>local_time_facet*</td>
<td>local_time_input_facet*</td>
</tr>
<tr>
<td>wlocal_time_facet*</td>
<td>wlocal_time_input_facet*</td>
</tr>
</tbody>
</table>
<h5 id="Formatter/Parser_u5BF9_u8C61"><a href="#Formatter/Parser_u5BF9_u8C61" class="headerlink" title="Formatter/Parser对象"></a>Formatter/Parser对象</h5><table>
<thead>
<tr>
<th>Output</th>
<th>Input</th>
</tr>
</thead>
<tbody>
<tr>
<td>period_formatter</td>
<td>period_parser</td>
</tr>
<tr>
<td>date_generator_formatter</td>
<td>date_generator_parser</td>
</tr>
<tr>
<td>special_values_formatter</td>
<td>special_values_parser</td>
</tr>
<tr>
<td>null</td>
<td>format_date_parser</td>
</tr>
</tbody>
</table>
<p>示例1：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">date <span class="title">d</span><span class="params">(<span class="number">2004</span>, Feb, <span class="number">29</span>)</span></span>;</span><br><span class="line"><span class="function">time_duration <span class="title">td</span><span class="params">(<span class="number">12</span>,<span class="number">34</span>,<span class="number">56</span>,<span class="number">789</span>)</span></span>;</span><br><span class="line"><span class="built_in">stringstream</span> ss;</span><br><span class="line">ss &lt;&lt; d &lt;&lt; <span class="string">' '</span> &lt;&lt; td;</span><br><span class="line"><span class="function">ptime <span class="title">pt</span><span class="params">(not_a_date_time)</span></span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; pt &lt;&lt; endl; <span class="comment">// "not-a-date-time"</span></span><br><span class="line">ss &gt;&gt; pt;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; pt &lt;&lt; endl; <span class="comment">// "2004-Feb-29 12:34:56.000789"</span></span><br><span class="line">ss.str(<span class="string">""</span>);</span><br><span class="line">ss &lt;&lt; pt &lt;&lt; <span class="string">" EDT-05EDT,M4.1.0,M10.5.0"</span>;</span><br><span class="line"><span class="function">local_date_time <span class="title">ldt</span><span class="params">(not_a_date_time)</span></span>;</span><br><span class="line">ss &gt;&gt; ldt;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ldt &lt;&lt; endl; <span class="comment">// "2004-Feb-29 12:34:56.000789 EDT"</span></span><br><span class="line"></span><br><span class="line">local_time_facet* output_facet = <span class="keyword">new</span> local_time_facet();</span><br><span class="line">local_time_input_facet* input_facet = <span class="keyword">new</span> local_time_input_facet();</span><br><span class="line">ss.imbue(locale(locale::classic(), output_facet));</span><br><span class="line">ss.imbue(locale(ss.getloc(), input_facet));</span><br><span class="line"></span><br><span class="line">output_facet-&gt;format(<span class="string">"%a %b %d, %H:%M %z"</span>);</span><br><span class="line">ss.str(<span class="string">""</span>);</span><br><span class="line">ss &lt;&lt; ldt;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ss.str() &lt;&lt; endl; <span class="comment">// "Sun Feb 29, 12:34 EDT"</span></span><br><span class="line"></span><br><span class="line">output_facet-&gt;format(local_time_facet::iso_time_format_specifier);</span><br><span class="line">ss.str(<span class="string">""</span>);</span><br><span class="line">ss &lt;&lt; ldt;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ss.str() &lt;&lt; endl; <span class="comment">// "20040229T123456.000789-0500"</span></span><br><span class="line"></span><br><span class="line">output_facet-&gt;format(local_time_facet::iso_time_format_extended_specifier);</span><br><span class="line">ss.str(<span class="string">""</span>);</span><br><span class="line">ss &lt;&lt; ldt;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ss.str() &lt;&lt; endl; <span class="comment">// "2004-02-29 12:34:56.000789-05:00"</span></span><br></pre></td></tr></table></figure></p>
<p>示例2，这是一个格式化时间的函数，应用最多的应该是格式化time_t时间（第二个函数）。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">std::string FormatTime(const ptime&amp; pt, const char* time_format) &#123;</span><br><span class="line">    std::stringstream stream;</span><br><span class="line">    std::locale currlocale(std::locale::classic(),</span><br><span class="line">                                        new time_facet(time_format));</span><br><span class="line">    stream.imbue(currlocale);</span><br><span class="line">    stream &lt;&lt; pt;</span><br><span class="line">    return stream.str();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::string FormatLocalTime(std::time_t t, const char* time_format) &#123;</span><br><span class="line">    return FormatTime(local_adj::utc_to_local(from_time_t(t)), time_format);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意<code>std::ios_base::imbue</code>就是设置本地化。<br>C++输入/输出库中的每一个stream对象都会关联一个locale对象，locale对象会使用facet去解析和格式化所有的数据。此外，每一个<code>std::basic_regxe</code>对象会关联一个locale对象。locale对象还可以用于标准容器和算法执行字符串排序时的断言。</p>
<p><strong>注意</strong>：<br><code>std::locale</code>构造函数的第二个参数facet，需要在堆中分配，如果使用局部变量（对象在栈中），会引起程序崩溃，而且最后也不要手工<code>delete</code>这个facet对象，因为<code>std::locale</code>在析构中会自动释放内存。<br>参看<a href="https://rhubbarb.wordpress.com/2009/10/17/boost-datetime-locales-and-facets/" target="_blank" rel="external">Boost DateTime, Locales and Facets</a></p>
<h2 id="std_3A_3Achrono_u4E0EBoost-Date_Time_u5173_u7CFB"><a href="#std_3A_3Achrono_u4E0EBoost-Date_Time_u5173_u7CFB" class="headerlink" title="std::chrono与Boost.Date_Time关系"></a>std::chrono与Boost.Date_Time关系</h2><p>Boost.Date_Time是关于日期和时间的库，它有很多用于为本地化显示而格式化日期的函数，而且有很多函数用于获取和操作日期和时间。<br>而std::chrono（或者boost::chrono）更关心处理时间（而非日期），它没有比hour更高的计时单位。它表示某一刻的时间仅是某一个参考时间点的偏移（例如从1970年1月1日开始）。这个库没有格式化函数，需要转换成<code>time_t</code>或者<code>tm</code>，使用C风格时间函数进行格式化。<br>这两个库可以互补，当然也有重复的地方。但是这两个库没有任何交互操作，所以不得不进行手工转换。<br>参见<a href="http://stackoverflow.com/questions/6730422/boost-chrono-vs-boost-date-time" target="_blank" rel="external">Boost.Chrono vs. Boost.Date_Time</a>。<br><code>time_t</code>可以作为这几个库进行转换的中转类型。因为这些库都提供了对它的转换函数。</p>
<hr>
<p><strong>版权声明</strong></p>
<p>本博客 <a href="http://oabinga.github.io/" target="_blank" rel="external">思</a> 采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="external">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议进行许可</a></p>
<p>本文永久链接：<a href="http://yoursite.com/2016/01/04/C++中与时间相关的库/">http://yoursite.com/2016/01/04/C++中与时间相关的库/</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://yoursite.com/2016/01/04/C++中与时间相关的库/" data-id="ciizrmmw9000aow39antzw1p9" class="article-share-link" data-share="baidu" data-title="C++中与时间相关的库">分享到</a>
      

      
        <a href="http://yoursite.com/2016/01/04/C++中与时间相关的库/#disqus_thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-boost/">C++ boost</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/01/04/开张/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">终于开张了</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/整理/">整理</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-boost/">C++ boost</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/01/04/C++中与时间相关的库/">C++中与时间相关的库</a>
          </li>
        
          <li>
            <a href="/2016/01/04/开张/">终于开张了</a>
          </li>
        
          <li>
            <a href="/2016/01/04/时间概念总结/">时间概念总结</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
     <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank"><img alt="知识共享许可协议" style="border-width:0" src="https://licensebuttons.net/l/by-nc-nd/3.0/88x31.png"></a><br>
      &copy; 2016 Oabinga<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a><br>
      <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      <span id="busuanzi_container_site_uv">
      您是本站的第<span id="busuanzi_value_site_uv"></span>个小伙伴：） 
    </div>
  </div>
</footer>

  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<script>
  var disqus_shortname = 'oabinga';
  
  var disqus_url = 'http://yoursite.com/2016/01/04/C++中与时间相关的库/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js" type="text/javascript"></script>

</div>
</body>
</html>
